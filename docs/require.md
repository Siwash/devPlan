 DevPlan - Rust 开发项目管理本地客户端                                                                                                                                                                          │
│                                                                                                                                                                                                                │
│ Context                                                                                                                                                                                                        │
│                                                                                                                                                                                                                │
│ 需要构建一个本地桌面客户端用于开发项目管理，核心场景包括：安排开发任务、盘点开发资源、整理开发项目。通过日历视图查看成员排期和项目周期，展示空闲资源，支持 Excel 导入/导出计划，并为后续 LLM                   │
│ 智能编排预留接口。                                                                                                                                                                                             │
│                                                                                                                                                                                                                │
│ 项目目录 D:\code\devPlan 中已有一个 Excel 模板文件 智能定制_sprint3_20260116_迭代计划 (1).xlsx，包含 5 个 sheet，其中 "Task" sheet 有 84 条任务数据，14                                                        │
│ 列（类型、编号、名称、描述、负责人、迭代、优先级、日期、工时、状态等），涉及 11 名团队成员。                                                                                                                   │
│                                                                                                                                                                                                                │
│ 技术栈                                                                                                                                                                                                         │
│                                                                                                                                                                                                                │
│ - 框架: Tauri v2（Rust 后端 + React 前端）                                                                                                                                                                     │
│ - 前端: React 18 + TypeScript + Vite + FullCalendar + Ant Design + Zustand                                                                                                                                     │
│ - 后端 Rust crates: calamine（读 Excel）、rust_xlsxwriter（写 Excel）、rusqlite（SQLite）、serde、chrono、jieba-rs（中文分词）、strsim（字符串相似度）                                                         │
│ - 数据存储: SQLite（bundled 编译进二进制）                                                                                                                                                                     │
│                                                                                                                                                                                                                │
│ 项目结构                                                                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ D:\code\devPlan\                                                                                                                                                                                               │
│ ├── src-tauri/                        # Rust 后端                                                                                                                                                              │
│ │   ├── Cargo.toml                                                                                                                                                                                             │
│ │   ├── tauri.conf.json                                                                                                                                                                                        │
│ │   └── src/                                                                                                                                                                                                   │
│ │       ├── main.rs                   # 入口，注册 commands                                                                                                                                                    │
│ │       ├── lib.rs                                                                                                                                                                                             │
│ │       ├── commands/                 # Tauri IPC 命令层                                                                                                                                                       │
│ │       │   ├── mod.rs                                                                                                                                                                                         │
│ │       │   ├── task_commands.rs                                                                                                                                                                               │
│ │       │   ├── developer_commands.rs                                                                                                                                                                          │
│ │       │   ├── sprint_commands.rs                                                                                                                                                                             │
│ │       │   ├── calendar_commands.rs                                                                                                                                                                           │
│ │       │   └── excel_commands.rs                                                                                                                                                                              │
│ │       ├── services/                 # 业务逻辑层                                                                                                                                                             │
│ │       │   ├── mod.rs                                                                                                                                                                                         │
│ │       │   ├── task_service.rs                                                                                                                                                                                │
│ │       │   ├── developer_service.rs                                                                                                                                                                           │
│ │       │   ├── schedule_service.rs   # 资源可用性计算                                                                                                                                                         │
│ │       │   └── import_export_service.rs                                                                                                                                                                       │
│ │       ├── excel/                    # Excel 处理                                                                                                                                                             │
│ │       │   ├── mod.rs                                                                                                                                                                                         │
│ │       │   ├── reader.rs            # calamine 读取                                                                                                                                                           │
│ │       │   ├── writer.rs            # rust_xlsxwriter 写出                                                                                                                                                    │
│ │       │   ├── smart_matcher.rs     # 智能 sheet/列匹配算法                                                                                                                                                   │
│ │       │   └── column_definitions.rs                                                                                                                                                                          │
│ │       ├── db/                       # 数据库层                                                                                                                                                               │
│ │       │   ├── mod.rs                                                                                                                                                                                         │
│ │       │   ├── init.rs              # 建表、迁移                                                                                                                                                              │
│ │       │   ├── task_repo.rs                                                                                                                                                                                   │
│ │       │   ├── developer_repo.rs                                                                                                                                                                              │
│ │       │   └── sprint_repo.rs                                                                                                                                                                                 │
│ │       ├── models/                   # 数据模型 + DTO                                                                                                                                                         │
│ │       │   ├── mod.rs                                                                                                                                                                                         │
│ │       │   ├── task.rs                                                                                                                                                                                        │
│ │       │   ├── developer.rs                                                                                                                                                                                   │
│ │       │   ├── sprint.rs                                                                                                                                                                                      │
│ │       │   ├── calendar.rs                                                                                                                                                                                    │
│ │       │   └── enums.rs                                                                                                                                                                                       │
│ │       └── llm/                      # 预留 LLM 接口                                                                                                                                                          │
│ │           ├── mod.rs                                                                                                                                                                                         │
│ │           └── adapter.rs                                                                                                                                                                                     │
│ ├── src/                              # React 前端                                                                                                                                                             │
│ │   ├── main.tsx                                                                                                                                                                                               │
│ │   ├── App.tsx                                                                                                                                                                                                │
│ │   ├── components/                                                                                                                                                                                            │
│ │   │   ├── layout/                  # AppLayout, Sidebar, Header                                                                                                                                              │
│ │   │   ├── calendar/               # CalendarView, ResourceView                                                                                                                                               │
│ │   │   ├── tasks/                  # TaskList, TaskForm, TaskDetail                                                                                                                                           │
│ │   │   ├── developers/            # DeveloperList, DeveloperProfile, DeveloperSchedule                                                                                                                        │
│ │   │   ├── gantt/                 # GanttView                                                                                                                                                                 │
│ │   │   ├── excel/                 # ImportWizard, ColumnMapper, ExportDialog                                                                                                                                  │
│ │   │   └── common/               # PriorityBadge, StatusBadge 等                                                                                                                                              │
│ │   ├── stores/                    # Zustand 状态管理                                                                                                                                                          │
│ │   ├── hooks/                     # 自定义 hooks                                                                                                                                                              │
│ │   └── lib/                       # 类型定义、工具函数、Tauri 调用封装                                                                                                                                        │
│ ├── package.json                                                                                                                                                                                               │
│ ├── vite.config.ts                                                                                                                                                                                             │
│ └── 智能定制_sprint3_20260116_迭代计划 (1).xlsx                                                                                                                                                                │
│                                                                                                                                                                                                                │
│ 数据模型（SQLite）                                                                                                                                                                                             │
│                                                                                                                                                                                                                │
│ 核心表                                                                                                                                                                                                         │
│                                                                                                                                                                                                                │
│ developers - 开发成员                                                                                                                                                                                          │
│ - id, name, roles(JSON), skills(JSON), max_hours_per_day, avatar_color, is_active                                                                                                                              │
│                                                                                                                                                                                                                │
│ projects - 项目                                                                                                                                                                                                │
│ - id, name, code, description                                                                                                                                                                                  │
│                                                                                                                                                                                                                │
│ sprints - 迭代                                                                                                                                                                                                 │
│ - id, name, project_id(FK), start_date, end_date, phase                                                                                                                                                        │
│                                                                                                                                                                                                                │
│ tasks - 任务                                                                                                                                                                                                   │
│ - id, external_id, task_type, name, description, owner_id(FK→developers), sprint_id(FK→sprints), priority, planned_start, planned_end, planned_hours, parent_task_id(FK→self), status                          │
│                                                                                                                                                                                                                │
│ task_co_owners - 任务协作人（多对多）                                                                                                                                                                          │
│ - task_id(FK), developer_id(FK)                                                                                                                                                                                │
│                                                                                                                                                                                                                │
│ import_history - 导入历史                                                                                                                                                                                      │
│ - id, file_name, file_path, import_date, sheet_name, column_mapping(JSON), rows_imported                                                                                                                       │
│                                                                                                                                                                                                                │
│ 枚举值（来自 Excel 模板）                                                                                                                                                                                      │
│                                                                                                                                                                                                                │
│ - 任务类型: 需求澄清, 技术预研, 产品设计, UE设计, 架构设计, 详细设计, 代码开发, 代码检查, 演示, 用例设计, 测试执行, 应用检查, JIRA BUG                                                                         │
│ - 优先级: P0, P1, P2                                                                                                                                                                                           │
│ - 状态: 待开始, 进行中, 已完成, 暂停中, 已取消                                                                                                                                                                 │
│ - 迭代: Sprint0 ~ Sprint12 等                                                                                                                                                                                  │
│                                                                                                                                                                                                                │
│ 核心功能实现                                                                                                                                                                                                   │
│                                                                                                                                                                                                                │
│ 1. 日历视图                                                                                                                                                                                                    │
│                                                                                                                                                                                                                │
│ 使用 FullCalendar React 组件，提供四种视图：                                                                                                                                                                   │
│ - 月视图 (dayGridMonth): 任务条跨越开始-结束日期，按颜色区分任务类型或负责人                                                                                                                                   │
│ - 周视图 (timeGridWeek): 每日分配详情                                                                                                                                                                          │
│ - 资源时间线 (resourceTimelineMonth): 行=开发人员，列=日期，直观展示谁忙谁空闲                                                                                                                                 │
│ - 甘特图: 使用 frappe-gantt 或 SVAR React Gantt 展示项目整体排期                                                                                                                                               │
│                                                                                                                                                                                                                │
│ 资源可用性计算（Rust schedule_service.rs）：                                                                                                                                                                   │
│ 每日分配工时 = task.planned_hours / 工作日天数(planned_start → planned_end)                                                                                                                                    │
│ 可用工时 = developer.max_hours_per_day - 当日所有任务分配工时之和                                                                                                                                              │
│                                                                                                                                                                                                                │
│ 人员切换: Header 中的 DeveloperSelector 组件，选择后过滤日历仅显示该成员任务。                                                                                                                                 │
│                                                                                                                                                                                                                │
│ 2. 开发成员管理                                                                                                                                                                                                │
│                                                                                                                                                                                                                │
│ - 录入姓名、角色（前端/后端/测试等）、技能标签、每日最大工时                                                                                                                                                   │
│ - Excel 导入时自动创建未识别的成员（从"负责人"列提取），后续手动补充角色和技能                                                                                                                                 │
│ - 个人日程页：展示该成员的日历、工作量柱状图、超负荷预警                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ 3. Excel 智能导入（核心差异化功能）                                                                                                                                                                            │
│                                                                                                                                                                                                                │
│ 四步导入向导:                                                                                                                                                                                                  │
│                                                                                                                                                                                                                │
│ Step 1 - 选择文件: 用 Tauri 文件对话框选 .xlsx 文件，后端分析所有 sheet                                                                                                                                        │
│                                                                                                                                                                                                                │
│ Step 2 - 智能 Sheet 匹配: 多信号评分算法（不写死 sheet 名）：                                                                                                                                                  │
│ - Sheet 名包含 "task"/"任务" 等关键词 → +0.2                                                                                                                                                                   │
│ - 列头匹配任务字段模式（编号/名称/负责人/日期等）→ +0.4                                                                                                                                                        │
│ - 数据形态分析（行列数、混合类型）→ +0.15                                                                                                                                                                      │
│ - 包含日期列 → +0.1                                                                                                                                                                                            │
│ - 单元格值匹配已知枚举（状态/优先级/迭代）→ +0.15                                                                                                                                                              │
│ - 隐藏 sheet 惩罚、汇总 sheet 惩罚                                                                                                                                                                             │
│ - 按得分排序展示给用户确认                                                                                                                                                                                     │
│                                                                                                                                                                                                                │
│ Step 3 - 智能列映射: 对每个列头进行多层匹配：                                                                                                                                                                  │
│ 1. 精确匹配中英文关键词（置信度 1.0）                                                                                                                                                                          │
│ 2. 子串包含匹配（0.7）                                                                                                                                                                                         │
│ 3. jieba 中文分词 + 词汇重叠（0.5）                                                                                                                                                                            │
│ 4. 数据类型验证加成（+0.15）                                                                                                                                                                                   │
│ 5. Jaro-Winkler 字符串相似度兜底（0.6×相似度）                                                                                                                                                                 │
│ - 展示映射界面，用户可调整                                                                                                                                                                                     │
│                                                                                                                                                                                                                │
│ Step 4 - 预览并导入: 展示前 20 行预览 → 确认后事务性导入                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ LLM 增强预留: 当匹配置信度低于阈值且配置了 LLM 时，将列头+样本数据发送给 LLM 辅助匹配。                                                                                                                        │
│                                                                                                                                                                                                                │
│ 4. Excel 导出                                                                                                                                                                                                  │
│                                                                                                                                                                                                                │
│ 使用 rust_xlsxwriter 生成 .xlsx 文件：                                                                                                                                                                         │
│ - Task sheet 保持与模板相同的列结构                                                                                                                                                                            │
│ - 可选导出迭代目标、数据汇总等 sheet                                                                                                                                                                           │
│ - 格式化：粗体表头、日期格式、列宽自适应                                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ 5. LLM 集成预留                                                                                                                                                                                                │
│                                                                                                                                                                                                                │
│ 定义 LlmAdapter trait：                                                                                                                                                                                        │
│ - analyze_sheet_mapping() - 辅助 Excel 列映射                                                                                                                                                                  │
│ - suggest_schedule() - 智能排期建议（根据任务、成员技能、可用时间自动编排）                                                                                                                                    │
│ - 未来实现 OpenAI 兼容适配器（reqwest HTTP 调用）                                                                                                                                                              │
│                                                                                                                                                                                                                │
│ 实施阶段                                                                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ 阶段 1: 项目基础                                                                                                                                                                                               │
│                                                                                                                                                                                                                │
│ - 初始化 Tauri v2 + React + TypeScript + Vite 项目                                                                                                                                                             │
│ - SQLite 数据库建表和初始化                                                                                                                                                                                    │
│ - 基础数据模型和 Repository 层                                                                                                                                                                                 │
│ - 任务 CRUD 的 Tauri commands                                                                                                                                                                                  │
│ - 基础 UI 布局（侧边栏、顶栏、内容区）                                                                                                                                                                         │
│ - 任务列表表格视图                                                                                                                                                                                             │
│                                                                                                                                                                                                                │
│ 阶段 2: Excel 导入导出                                                                                                                                                                                         │
│                                                                                                                                                                                                                │
│ - calamine 读取 Excel                                                                                                                                                                                          │
│ - 智能 sheet/列匹配算法（jieba-rs + strsim）                                                                                                                                                                   │
│ - 导入向导 UI（四步流程）                                                                                                                                                                                      │
│ - 用模板文件测试导入                                                                                                                                                                                           │
│ - rust_xlsxwriter 导出                                                                                                                                                                                         │
│ - 导入历史记录                                                                                                                                                                                                 │
│                                                                                                                                                                                                                │
│ 阶段 3: 日历视图                                                                                                                                                                                               │
│                                                                                                                                                                                                                │
│ - 集成 FullCalendar（月/周/日视图）                                                                                                                                                                            │
│ - 资源时间线视图（人员行 × 日期列）                                                                                                                                                                            │
│ - 资源可用性计算                                                                                                                                                                                               │
│ - 拖拽调整排期                                                                                                                                                                                                 │
│ - 事件提示卡和点击详情                                                                                                                                                                                         │
│                                                                                                                                                                                                                │
│ 阶段 4: 成员管理 + 甘特图                                                                                                                                                                                      │
│                                                                                                                                                                                                                │
│ - 成员档案 CRUD（角色、技能、工时）                                                                                                                                                                            │
│ - 人员切换和个人日程视图                                                                                                                                                                                       │
│ - 工作量可视化图表                                                                                                                                                                                             │
│ - 甘特图视图                                                                                                                                                                                                   │
│                                                                                                                                                                                                                │
│ 阶段 5: LLM 集成（后续）                                                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ - LlmAdapter trait 实现                                                                                                                                                                                        │
│ - 集成到导入流程（增强列映射）                                                                                                                                                                                 │
│ - 智能排期建议功能                                                                                                                                                                                             │
│                                                                                                                                                                                                                │
│ 验证方式                                                                                                                                                                                                       │
│                                                                                                                                                                                                                │
│ 1. cargo tauri dev 启动开发模式，验证 Rust 后端编译和前端热更新                                                                                                                                                │
│ 2. 导入项目中的 Excel 模板文件，验证智能匹配和数据导入正确性                                                                                                                                                   │
│ 3. 在日历视图中查看导入的任务排期，切换月/周/资源时间线视图                                                                                                                                                    │
│ 4. 切换不同开发人员查看个人日程，验证空闲资源展示                                                                                                                                                              │
│ 5. 创建/编辑/删除任务，验证 CRUD 完整性                                                                                                                                                                        │
│ 6. 导出为 Excel，对比原模板格式                                                                                                                                                                                │
│ 7. 为开发成员添加角色和技能标签，验证存储和展示
│                                                                                                                                                                                                                │
│ 6. 早会记录模块 (Daily Standup)                                                                                                                                                                                │
│                                                                                                                                                                                                                │
│ 支持团队每日站会记录，按日期管理早会内容：                                                                                                                                                                     │
│ - 每人三栏汇报：昨日完成（done_items）、今日计划（plan_items）、问题/阻碍（blockers）                                                                                                                          │
│ - 汇报条目可关联系统中的任务（通过 standup_task_links 表实现多对多关联）                                                                                                                                       │
│ - 数据库三表设计：standup_meetings（按日期唯一）、standup_entries（每人每会一条）、standup_task_links（条目与任务关联）                                                                                          │
│ - 前端 StandupPage：日期切换、查看/编辑模式切换、每人卡片式三栏布局                                                                                                                                            │
│ - 路由 /standup，侧边栏新增菜单入口                                                                                                                                                                            │
│                                                                                                                                                                                                                │
│ 7. Excel 导入更新机制                                                                                                                                                                                          │
│                                                                                                                                                                                                                │
│ 导入 Excel 时支持与已有数据的冲突检测和处理：                                                                                                                                                                  │
│ - 冲突检测规则：按 external_id（外部编号）精确匹配 + 按 name（任务名称）模糊匹配                                                                                                                               │
│ - 三种冲突处理模式：skip（跳过已存在）、update（覆盖更新）、create_new（全部新建）                                                                                                                             │
│ - 导入向导新增冲突检测步骤（预览数据后、正式导入前），展示冲突列表供用户选择处理方式                                                                                                                           │
│ - 后端 detect_import_conflicts 函数 + 对应 Tauri 命令                                                                                                                                                          │
│                                                                                                                                                                                                                │
│ 8. 排期日期智能排除                                                                                                                                                                                            │
│                                                                                                                                                                                                                │
│ 任务排期时 DatePicker 自动标识开发者工作负荷状态：                                                                                                                                                             │
│ - 已满日期（当日分配工时 >= max_hours_per_day）：禁用不可选                                                                                                                                                    │
│ - 快满日期（当日分配工时 >= max_hours_per_day * 80%）：黄色视觉提示                                                                                                                                            │
│ - 任务隔离：编辑某任务时，不将该任务自身的工时计入已占用（避免修改日期时自己阻塞自己）                                                                                                                         │
│ - 通过 useWorkdayStatus Hook 统一管理，EditableTaskTable 和 TaskForm 的日期选择器均集成